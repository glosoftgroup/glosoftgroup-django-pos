{% extends 'dashboard/base.html' %}
{% load i18n %}
{% load materializecss %}
{% load static %}
{% block title %}
  {% if site.pk %}
    {{ site.name }}
  {% else %}
    {% trans "Add new site settings" context "Site settings page title" %}
  {% endif %}
   - {% trans "Site settings" context "Dashboard site settings" %} - {{ block.super }}
{% endblock %}

{% block body_class %}body-settings{% endblock %}

{% block menu_settings_class %}active{% endblock %}

{% block breadcrumbs %}
  <li class="active">
        <a href="{% url 'dashboard:site-index' %}">
             {% trans "Site settings" context "Dashboard site settings" %}
        </a>
    </li>
{% endblock %}

{% block custom_css %}
<style type="text/css">
  .error {
        color: #ff5722;
    }

</style>
{% endblock %}

{% block content %}
 <div class="panel panel-flat">  
    <div class="panel-body">
                  <div class="tabbable">
                    <ul class="nav nav-tabs nav-tabs-highlight"  style="margin-bottom:0px;">
                      <li class="active"><a href="#basic" data-toggle="tab">Basic Settings</a></li>
                      <li><a href="#sms" data-toggle="tab" disabled>Communications</a></li>
                      <li><a href="#db" data-toggle="tab">Databases</a></li>                    
                    </ul>

                    <div class="tab-content" style="margin-bottom:0px;">
                      <div class="tab-pane fade in active" id="basic">
                       <!--  basic settings -->
                        {% include "dashboard/sites/_basic_config.html" with form=form %}
                        <!-- ./end bsettings -->
                      </div>

                      <div class="tab-pane fade" id="sms">
                       <!--  products -->
                       {% include "dashboard/sites/_sms_config.html" with form=form %}
                        <!-- ./products -->
                      </div>

                      <div class="tab-pane fade" id="db">
                       <!--  products -->
                       {% include "dashboard/sites/_db.html" with form=form %}
                        <!-- ./products -->
                      </div>

                      <div class="tab-pane fade" id="sales">
                        sales
                        ./sales
                      </div>                      
                    </div>
                  </div>
                </div>
    
    <div class="col m12 l3 help-box"></div>
  </div>
<!-- page usrls -->
<input type="hidden" class="pageUrls" data-updateurl="{% url 'dashboard:update-settings' site_id=1 %}" name="">
<input type="hidden" class="redirectUrls" data-redirecturl="{% url 'dashboard:site-index' %}" name="">
{% endblock %}

{% block custom_js %}
<script type="text/javascript">
$( document ).ready(function() {
  $( "label" ).addClass( "text-bold" );
});
</script>
<script type="text/javascript" src="{% static 'backend/js/plugins/forms/styling/uniform.min.js' %}"></script>
<script type="text/javascript" src="{% static 'backend/js/plugins/pickers/pickadate/picker.time.js' %}"></script>
<script type="text/javascript" src="{% static 'backend/js/pages/form_inputs.js' %}"></script>
<script type="text/javascript" src="{% static 'backend/js/plugins/pickers/anytime.min.js' %}"></script>
<script type="text/javascript" src="{% static 'backend/js/pages/picker_date.js' %}"></script>
<script type="text/javascript" src="{% static 'backend/js/site-settings.js' %}"></script>
<script type="text/javascript">
  // Editable input
   
    $('.octime').pickatime({
        editable: true,
        format:'HH:i A',
        formatSubmit:'HH:i A'
    });

    $(document).ready(function(){
        $('.import_btn').on('click', function(){
          var f = document.getElementById('database-form');
          var formData = new FormData(f);

          var file = $('.db')[0].files[0];
          var filename = $('.db').val();

          if(file){
            formData.append("db", file);

            var fileExtension = ['json'];
            if ($.inArray(filename.split('.').pop().toLowerCase(), fileExtension) == -1) {
                alert("Only formats are allowed : "+fileExtension.join(', '));
            }
            
            var extension = $('.db').val().replace(/^.*\./, '');
            $.ajax({
                url: "{% url 'dashboard:import_db' %}",
                data: formData,
                cache: false,
                contentType: false,
                processData: false,
                method: 'POST',
                type: 'POST',
                success: function(data){
                    alert(data);
                }
            });
          }else{
            alert('please choose a file')
          }
        });
});

</script>
{% endblock %}